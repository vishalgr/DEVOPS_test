<?xml version="1.0" encoding="utf-8"?>
<!--
  Main Build script
-->

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
  DefaultTargets="Publish" >

  <PropertyGroup>
    <MSBuildProjectDirectoryWithSlash Condition="HasTrailingSlash('$(MSBuildProjectDirectory)')"
    >$(MSBuildProjectDirectory)</MSBuildProjectDirectoryWithSlash>
    <StopOnFirstFailure>true</StopOnFirstFailure>
    <CodebasePath>..\</CodebasePath>

  </PropertyGroup>
  
  <!-- Collect publish scripts. -->
  <Target Name="_CollectPublishScripts">

     <!-- Contents to be published -->
     <ItemGroup>
        <PackageContent Include="$(CodebasePath)..\tools\CSVConverter\Output\Bin\*.*">
          <PackageName>CSVConverter</PackageName>
        </PackageContent>
        <PackageContent Include="$(CodebasePath)..\tools\TestRunner\Output\Bin\*.*">
          <PackageName>TestRunner</PackageName>
        </PackageContent>
        <PackageContent Include="$(CodebasePath)..\tools\LoginApplication\Output\Bin\*.*">
          <PackageName>LoginApplication</PackageName>
        </PackageContent>
        <PackageContent Include="$(CodebasePath)..\Examples\HelloWorld\Output\Bin\*.*">
          <PackageName>HelloWorld</PackageName>
        </PackageContent>
    </ItemGroup> 
  
    <Message Text="PackageContent: %(PackageContent.PackageName)" />
  </Target>
  
  <Target Name="CopyToMainPublish">  
    <Copy
        SourceFiles="@(PackageContent)"
        DestinationFiles="@(PackageContent->'$(MainPublishDirectory)\%(PackageName)\%(Filename)%(Extension)')"
    />
    <!-- Create combined package for testing purpose -->
    <Copy
        SourceFiles="@(PackageContent)"
        DestinationFiles="@(PackageContent->'$(MainPublishDirectory)\Combined\%(Filename)%(Extension)')"
    />
  </Target>

   <Target Name="Publish_" DependsOnTargets="_CollectPublishScripts;CopyToMainPublish"/>
   <!-- Condition=" '@(PackageContent)' != '' " -->
</Project>